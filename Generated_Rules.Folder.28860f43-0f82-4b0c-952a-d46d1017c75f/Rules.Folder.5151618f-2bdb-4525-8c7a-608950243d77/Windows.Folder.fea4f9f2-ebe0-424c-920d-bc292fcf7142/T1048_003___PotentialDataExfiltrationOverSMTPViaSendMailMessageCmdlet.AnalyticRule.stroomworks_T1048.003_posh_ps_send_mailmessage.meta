{
  "analyticProcessType" : "STREAMING",
  "description" : "Detects the execution of a PowerShell script with a call to the \"Send-MailMessage\" cmdlet along with the \"-Attachments\" flag. This could be a potential sign of data exfiltration via Email.\nAdversaries may steal data by exfiltrating it over an un-encrypted network protocol other than that of the existing command and control channel. The data may also be sent to an alternate network location from the main command and control server.\n\n\nLevel: medium\n\nStatus: test\n\nFalse Positives:\n- Unknown\n\nReferences:\n- https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1048.003/T1048.003.md#atomic-test-5---exfiltration-over-alternative-protocol---smtp\n- https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/send-mailmessage?view=powershell-7.4\n- https://www.ietf.org/rfc/rfc2821.txt\n\nTags:\n- attack.exfiltration\n- attack.t1048.003\n- detection.threat-hunting\n\nSource Sigma rule author(s):\n- frack113\n\nSource Sigma rule: posh\\_ps\\_send\\_mailmessage.yml",
  "duplicateNotificationConfig" : {
    "chooseColumns" : false,
    "columnNames" : [ ],
    "rememberNotifications" : false,
    "suppressDuplicateNotifications" : false
  },
  "errorFeed" : {
    "type" : "Feed",
    "uuid" : "8b95697a-1827-4e67-b982-940f3d47634c",
    "name" : "RULE_ERRORS_FEED"
  },
  "includeRuleDocumentation" : false,
  "languageVersion" : "STROOM_QL_VERSION_0_1",
  "level" : "medium",
  "name" : "T1048.003 - PotentialDataExfiltrationOverSMTPViaSendMailMessageCmdlet",
  "notifications" : [ {
    "destination" : {
      "type" : "stream",
      "destinationFeed" : {
        "type" : "Feed",
        "uuid" : "f58bb9a9-1359-4077-9451-f977b2b862c3",
        "name" : "RULE_OUTPUT_FEED"
      },
      "useSourceFeedIfPossible" : false
    },
    "destinationType" : "STREAM",
    "enabled" : true,
    "limitNotifications" : false,
    "maxNotifications" : 1,
    "resumeAfter" : {
      "time" : 1,
      "timeUnit" : "DAYS"
    },
    "uuid" : "9ed54c1d-6c2c-41e0-aae1-fe3a25c5f77c"
  } ],
  "query" : "from RULE_VIEW\nwhere (EventData.ScriptBlockText = '*Send-MailMessage*-Attachments*')\nselect *",
  "rememberNotifications" : false,
  "status" : "test",
  "suppressDuplicateNotifications" : false,
  "timeRange" : {
    "name" : "All time",
    "condition" : "BETWEEN"
  },
  "uuid" : "stroomworks_T1048.003_posh_ps_send_mailmessage",
  "version" : "c96e0000-dea0-4c3a-88cc-a107449521e1",
  "type" : "AnalyticRule"
}