{
  "analyticProcessType" : "STREAMING",
  "description" : "Detects the creation of an \"Active Directory Schema Cache File\" (.sch) file by an uncommon tool.\n\nLevel: medium\n\nStatus: test\n\nFalse Positives:\n- Other legimate tools, which do ADSI (LDAP) operations, e.g. any remoting activity by MMC, Powershell, Windows etc.\n\nReferences:\n- https://medium.com/@ivecodoe/detecting-ldapfragger-a-newly-released-cobalt-strike-beacon-using-ldap-for-c2-communication-c274a7f00961\n- https://blog.fox-it.com/2020/03/19/ldapfragger-command-and-control-over-ldap-attributes/\n- https://github.com/fox-it/LDAPFragger\n\nTags:\n- attack.t1001.003\n- attack.command-and-control\n\nSource Sigma rule author(s):\n- xknow @xknow\\_infosec\n- Tim Shelton\n\nSource Sigma rule: file\\_event\\_win\\_adsi\\_cache\\_creation\\_by\\_uncommon\\_tool.yml",
  "duplicateNotificationConfig" : {
    "chooseColumns" : false,
    "columnNames" : [ ],
    "rememberNotifications" : false,
    "suppressDuplicateNotifications" : false
  },
  "errorFeed" : {
    "type" : "Feed",
    "uuid" : "8b95697a-1827-4e67-b982-940f3d47634c",
    "name" : "RULE_ERRORS_FEED"
  },
  "includeRuleDocumentation" : false,
  "languageVersion" : "STROOM_QL_VERSION_0_1",
  "level" : "medium",
  "name" : "T1001.003 - ADSICacheFileCreationByUncommonTool",
  "notifications" : [ {
    "destination" : {
      "type" : "stream",
      "destinationFeed" : {
        "type" : "Feed",
        "uuid" : "f58bb9a9-1359-4077-9451-f977b2b862c3",
        "name" : "RULE_OUTPUT_FEED"
      },
      "useSourceFeedIfPossible" : false
    },
    "destinationType" : "STREAM",
    "enabled" : true,
    "limitNotifications" : false,
    "maxNotifications" : 1,
    "resumeAfter" : {
      "time" : 1,
      "timeUnit" : "DAYS"
    },
    "uuid" : "9ed54c1d-6c2c-41e0-aae1-fe3a25c5f77c"
  } ],
  "query" : "from RULE_VIEW\nwhere ((EventData.TargetFilename = '*\\\\\\\\Local\\\\\\\\Microsoft\\\\\\\\Windows\\\\\\\\SchCache\\\\\\\\*' and EventData.TargetFilename = '*.sch*') and not ((((EventData.Image = ':\\\\\\\\Program Files\\\\\\\\Cylance\\\\\\\\Desktop\\\\\\\\CylanceSvc.exe' or EventData.Image = ':\\\\\\\\Windows\\\\\\\\CCM\\\\\\\\CcmExec.exe' or EventData.Image = ':\\\\\\\\windows\\\\\\\\system32\\\\\\\\dllhost.exe' or EventData.Image = ':\\\\\\\\Windows\\\\\\\\system32\\\\\\\\dsac.exe' or EventData.Image = ':\\\\\\\\Windows\\\\\\\\system32\\\\\\\\efsui.exe' or EventData.Image = ':\\\\\\\\windows\\\\\\\\system32\\\\\\\\mmc.exe' or EventData.Image = ':\\\\\\\\windows\\\\\\\\system32\\\\\\\\svchost.exe' or EventData.Image = ':\\\\\\\\Windows\\\\\\\\System32\\\\\\\\wbem\\\\\\\\WmiPrvSE.exe' or EventData.Image = ':\\\\\\\\windows\\\\\\\\system32\\\\\\\\WindowsPowerShell\\\\\\\\v1.0\\\\\\\\powershell.exe')) or ((EventData.Image = ':\\\\\\\\Windows\\\\\\\\ccmsetup\\\\\\\\autoupgrade\\\\\\\\ccmsetup' or EventData.Image = ':\\\\\\\\Program Files\\\\\\\\SentinelOne\\\\\\\\Sentinel Agent'))) or ((EventData.Image = ':\\\\\\\\Program Files\\\\\\\\' or EventData.Image = '*\\\\\\\\Microsoft Office') and EventData.Image = '*\\\\\\\\OUTLOOK.EXE'))) and not ((EventData.Image = '\\\\\\\\LANDesk\\\\\\\\LDCLient\\\\\\\\ldapwhoami.exe') or (EventData.Image = ':\\\\\\\\Program Files\\\\\\\\Citrix\\\\\\\\Receiver StoreFront\\\\\\\\Services\\\\\\\\DefaultDomainServices\\\\\\\\Citrix.DeliveryServices.DomainServices.ServiceHost.exe'))\nselect *",
  "rememberNotifications" : false,
  "status" : "test",
  "suppressDuplicateNotifications" : false,
  "timeRange" : {
    "name" : "All time",
    "condition" : "BETWEEN"
  },
  "uuid" : "stroomworks_T1001.003_file_event_win_adsi_cache_creation_by_uncommon_too",
  "version" : "c96e0000-dea0-4c3a-88cc-a107449521e1",
  "type" : "AnalyticRule"
}